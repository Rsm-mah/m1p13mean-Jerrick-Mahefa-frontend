<!-- pages/products/products.html -->
<div class="products-page">
  <!-- Header -->
  <div class="products-header">
    <div class="header-left">
      <div class="category-tabs">
        <button 
          class="category-tab" 
          [class.active]="selectedCategory === 'All'"
          (click)="filterByCategory('All')"
        >
          Tous
        </button>
        <button 
          class="category-tab" 
          *ngFor="let cat of categories"
          [class.active]="selectedCategory === cat"
          (click)="filterByCategory(cat)"
        >
          {{ cat }}
        </button>
      </div>
    </div>
    <div class="header-right">
      <button class="create-btn" (click)="openCreateModal()">
        <mat-icon>add</mat-icon>
        Ajouter
      </button>
    </div>
  </div>

  <!-- Loading State - Centré parfaitement -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-content">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Chargement des produits...</p>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="!isLoading && errorMessage">
    <div class="error-content">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <h3>Une erreur est survenue</h3>
      <p>{{ errorMessage }}</p>
      <button class="retry-btn" (click)="retry()">
        <mat-icon>refresh</mat-icon>
        Réessayer
      </button>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-container" *ngIf="!isLoading && !errorMessage && getFilteredProducts().length === 0">
    <div class="empty-content">
      <mat-icon class="empty-icon">inventory_2</mat-icon>
      <h3>Aucun produit trouvé</h3>
      <p>Commencez par créer votre premier produit</p>
      <button class="create-btn" (click)="openCreateModal()">
        <mat-icon>add</mat-icon>
        Créer un produit
      </button>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="products-grid" *ngIf="!isLoading && !errorMessage && getFilteredProducts().length > 0">
    <mat-card class="product-card" *ngFor="let product of getFilteredProducts()">
      <!-- Badge -->
      <div class="product-badge" *ngIf="getBadge(product)" [class]="getBadge(product)?.toLowerCase()">
        {{ getBadge(product) }}
      </div>
      
      <!-- Menu -->
      <button class="product-menu" mat-icon-button [matMenuTriggerFor]="menu">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="editProduct(product)">
          <mat-icon>edit</mat-icon>
          <span>Edit</span>
        </button>
        <button mat-menu-item (click)="deleteProduct(product)" style="color: #ef4444;">
          <mat-icon>delete</mat-icon>
          <span>Delete</span>
        </button>
      </mat-menu>

      <!-- Product Image -->
      <div class="product-image">
        <img [src]="getFirstImage(product)" [alt]="product.name" loading="lazy">
      </div>

      <!-- Product Info -->
      <mat-card-content class="product-info">
        <div class="product-shop">{{ product.shopId?.name || 'Boutique' }}</div>
        <div class="product-category">{{ product.categoryId?.name || 'Non catégorisé' }}</div>
        <h3 class="product-name">{{ product.name }}</h3>
        <p class="product-description">{{ product.description || 'Aucune description' }}</p>
        
        <div class="product-footer">
          <span class="product-price">{{ getFirstPrice(product) | currency:'Ar ':'symbol':'1.0-0' }}</span>
          <span class="product-stock" [class.low-stock]="getTotalStock(product) < 20">
            Stock: {{ getTotalStock(product) }}
          </span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  
  <!-- Pagination Controls -->
  <div class="pagination-controls" *ngIf="!isLoading && !errorMessage && totalPages > 1">
    <button mat-button (click)="prevPage()" [disabled]="currentPage === 1">
      <mat-icon>chevron_left</mat-icon>
      Précédent
    </button>

    <div class="page-list">
      <button mat-button *ngFor="let p of [].constructor(totalPages); let i = index"
        (click)="changePage(i + 1)"
        [class.active]="currentPage === (i + 1)">
        {{ i + 1 }}
      </button>
    </div>

    <button mat-button (click)="nextPage()" [disabled]="currentPage === totalPages">
      Suivant
      <mat-icon>chevron_right</mat-icon>
    </button>
  </div>
</div> 
<div class="modal-container">

  <!-- HEADER -->
  <div class="modal-header">
    <div class="modal-title">
      <h2>{{ getTitle() }}</h2>
      <p>{{ getSubtitle() }}</p>
    </div>
    <button class="close-btn" (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-divider></mat-divider>

  <div class="modal-body">

    <!-- Nom catégorie -->
    <div class="form-section">
      <div class="form-group">
        <label>Nom de la catégorie <span class="required">*</span></label>
        <input 
          class="form-control"
          [(ngModel)]="category.name"
          placeholder="Ex : Vêtements"
        >
      </div>
    </div>

    <mat-divider></mat-divider>

    <!-- ATTRIBUTS -->
    <div class="form-section">
      <div class="section-header">
        <h3>Attributs</h3>
        <button class="btn-secondary small" (click)="addAttribute()">
          + Ajouter
        </button>
      </div>

      <div class="attributes-grid">

        <div class="attribute-card" *ngFor="let attr of category.attributes; let i = index">

          <!-- Header card -->
          <div class="attribute-header">
            <span>Attribut {{ i + 1 }}</span>
            <button class="remove-attr" (click)="removeAttribute(i)">
              <mat-icon>close</mat-icon>
            </button>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Label</label>
              <!-- ✅ [(ngModel)] fonctionne car attr.label est bien dans l'objet -->
              <input class="form-control" [(ngModel)]="attr.label" placeholder="Ex : Taille">
            </div>

            <div class="form-group">
              <label>Clé</label>
              <input class="form-control" [(ngModel)]="attr.key" placeholder="Ex : size">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Type</label>
              <select class="form-control" [(ngModel)]="attr.type">
                <option value="string">Texte</option>
                <option value="number">Nombre</option>
                <option value="select">Liste</option>
                <option value="multiselect">Multi-liste</option>
                <option value="boolean">Oui / Non</option>
                <option value="textarea">Texte long</option>
              </select>
            </div>

            <div class="form-group checkbox-align">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="attr.required">
                <span>Obligatoire</span>
              </label>
            </div>
          </div>

          <div class="form-group" *ngIf="attr.type === 'select' || attr.type === 'multiselect'">
            <label>Options <span style="color:#94a3b8; font-weight:400;">(séparées par des virgules)</span></label>
            <input 
              class="form-control"
              [(ngModel)]="attr.optionsString"
              placeholder="Ex : S,M,L,XL"
              (ngModelChange)="onOptionsChange(attr, $event)"
            >
          </div>

        </div>

      </div>
    </div>

  </div>

  <mat-divider></mat-divider>

  <!-- FOOTER -->
  <div class="modal-footer">
    <button class="btn-secondary" (click)="close()">
      Annuler
    </button>
    <button class="btn-primary" (click)="submit()">
      {{ getButtonText() }}
    </button>
  </div>

</div>